# 集成调试 Webpack 源码，在已有项目中快速试错

# 最小化复现关心的问题

## 定义问题

### 背景

在我们的业务场景中，后端通过 Thrift idl 定义接口的入参和返回值。我们使用工具将 idl 转换成 TypeScript 文件后，前端代码就能使用后端接口的类型定义了。

### 问题

我希望解决的问题是：
当业务代码导入 `~idl/tos` 时，如果 `~idl/tos` 对应的 TypeScript 文件不存在，再生成该 TS 文件。这样就实现了**按需生成接口 TS 文件**的目的。

## 简化项目，最小化复现问题

### git worktree 单独开目录

因为在进行技术重构的同时需要兼顾业务开发，而对 Webpack 的修改又经常引起整个项目出错，所以为了减少对业务开发的影响，建议将 Webpack 相关工作单独放一个目录中进行。

可以使用 `git clone` 将项目克隆到新目录。但建议使用 `git worktree`，因为它不需要克隆两次，这在项目很大时可以节约很多时间。

```sh
# new-dir 是即将创建的目录，该目录跟 `git clone` 时效果一样
# branch 是新目录的 git HEAD
git worktree add new-dir branch
```

### 简化项目

真实项目的业务代码非常多，每次启动项目都要花费几十秒。而修改了 Webpack 相关代码都需要重启才能生效，甚至某些场景中还需要清理缓存，导致需要更长的启动时间。如果每次修改后都要等几十秒，那么开发效率就太低了。

因此建议修改 Webpack 的入口文件，使用尽量少的业务代码覆盖关心的问题。例如，在我

1. 不修改 Webpack 版本和配置，保证 Webpack 的运行环境与真实环境一致。毕竟将解决方案整合进已有项目才是目的。
2. 项目小，不仅能提升启动速度，也能更聚焦到需要解决的问题上。

# 将 Webpack 源码与新工程关联起来
